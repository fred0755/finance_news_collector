#!/usr/bin/env python
"""
ä»ä¸œæ–¹è´¢å¯ŒæŠ“å–è¡Œä¸šåˆ†ç±»å’Œé¢˜ææ¦‚å¿µ
è¿è¡Œæ–¹å¼ï¼špython fetch_from_eastmoney.py
"""

import requests
from bs4 import BeautifulSoup
import json
import time
import re
from pathlib import Path
from datetime import datetime
from typing import Dict, List, Tuple


class EastMoneyTagFetcher:
    """ä¸œæ–¹è´¢å¯Œæ ‡ç­¾æŠ“å–å™¨"""

    def __init__(self):
        self.headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
        }
        self.session = requests.Session()
        self.session.headers.update(self.headers)

    def fetch_industries(self) -> Dict:
        """
        æŠ“å–è¡Œä¸šåˆ†ç±»ï¼ˆä¸‰çº§ï¼‰
        ä¸œæ–¹è´¢å¯Œè¡Œä¸šä¸­å¿ƒï¼šhttps://quote.eastmoney.com/center/list.html
        """
        print("ğŸ”„ æ­£åœ¨æŠ“å–è¡Œä¸šåˆ†ç±»...")

        # è¡Œä¸šæ•°æ®API
        industry_api = "https://push2.eastmoney.com/api/qt/clist/get"

        industries = {
            "level1": []
        }

        # ä¸€çº§è¡Œä¸šåˆ—è¡¨ï¼ˆæ ¹æ®ä¸œæ–¹è´¢å¯Œå®é™…åˆ†ç±»ï¼‰
        level1_list = [
            {"id": "I01", "name": "åˆ¶é€ ä¸š", "code": "C"},
            {"id": "I02", "name": "é‡‘èä¸š", "code": "J"},
            {"id": "I03", "name": "ä¿¡æ¯ä¼ è¾“ã€è½¯ä»¶å’Œä¿¡æ¯æŠ€æœ¯æœåŠ¡ä¸š", "code": "I"},
            {"id": "I04", "name": "æˆ¿åœ°äº§ä¸š", "code": "K"},
            {"id": "I05", "name": "é‡‡çŸ¿ä¸š", "code": "B"},
            {"id": "I06", "name": "ç”µåŠ›ã€çƒ­åŠ›ã€ç‡ƒæ°”åŠæ°´ç”Ÿäº§å’Œä¾›åº”ä¸š", "code": "D"},
            {"id": "I07", "name": "æ‰¹å‘å’Œé›¶å”®ä¸š", "code": "F"},
            {"id": "I08", "name": "äº¤é€šè¿è¾“ã€ä»“å‚¨å’Œé‚®æ”¿ä¸š", "code": "G"},
            {"id": "I09", "name": "å»ºç­‘ä¸š", "code": "E"},
            {"id": "I10", "name": "å†œã€æ—ã€ç‰§ã€æ¸”ä¸š", "code": "A"}
        ]

        for level1 in level1_list:
            print(f"  ğŸ“ å¤„ç†ä¸€çº§è¡Œä¸š: {level1['name']}")

            level1_item = {
                "id": level1["id"],
                "name": level1["name"],
                "level2": []
            }

            # è·å–äºŒçº§è¡Œä¸šï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…å¯èƒ½éœ€è¦ä»é¡µé¢è§£æï¼‰
            # ç¤ºä¾‹ï¼šä¸ºåˆ¶é€ ä¸šæ·»åŠ äºŒçº§è¡Œä¸š
            if level1["name"] == "åˆ¶é€ ä¸š":
                level2_list = [
                    {"id": f"{level1['id']}01", "name": "è®¡ç®—æœºã€é€šä¿¡å’Œå…¶ä»–ç”µå­è®¾å¤‡åˆ¶é€ ä¸š", "code": "C39"},
                    {"id": f"{level1['id']}02", "name": "ç”µæ°”æœºæ¢°å’Œå™¨æåˆ¶é€ ä¸š", "code": "C38"},
                    {"id": f"{level1['id']}03", "name": "æ±½è½¦åˆ¶é€ ä¸š", "code": "C36"},
                    {"id": f"{level1['id']}04", "name": "åŒ»è¯åˆ¶é€ ä¸š", "code": "C27"},
                    {"id": f"{level1['id']}05", "name": "åŒ–å­¦åŸæ–™å’ŒåŒ–å­¦åˆ¶å“åˆ¶é€ ä¸š", "code": "C26"},
                    {"id": f"{level1['id']}06", "name": "ä¸“ç”¨è®¾å¤‡åˆ¶é€ ä¸š", "code": "C35"},
                    {"id": f"{level1['id']}07", "name": "é€šç”¨è®¾å¤‡åˆ¶é€ ä¸š", "code": "C34"},
                    {"id": f"{level1['id']}08", "name": "é£Ÿå“åˆ¶é€ ä¸š", "code": "C14"},
                    {"id": f"{level1['id']}09", "name": "é…’ã€é¥®æ–™å’Œç²¾åˆ¶èŒ¶åˆ¶é€ ä¸š", "code": "C15"},
                    {"id": f"{level1['id']}10", "name": "çººç»‡ä¸š", "code": "C17"}
                ]
            elif level1["name"] == "é‡‘èä¸š":
                level2_list = [
                    {"id": f"{level1['id']}01", "name": "è´§å¸é‡‘èæœåŠ¡", "code": "J66"},
                    {"id": f"{level1['id']}02", "name": "èµ„æœ¬å¸‚åœºæœåŠ¡", "code": "J67"},
                    {"id": f"{level1['id']}03", "name": "ä¿é™©ä¸š", "code": "J68"}
                ]
            else:
                level2_list = []

            # ä¸ºæ¯ä¸ªäºŒçº§è¡Œä¸šæ·»åŠ ä¸‰çº§è¡Œä¸šå’Œå…³é”®è¯
            for level2 in level2_list:
                print(f"    ğŸ“‚ å¤„ç†äºŒçº§è¡Œä¸š: {level2['name']}")

                level2_item = {
                    "id": level2["id"],
                    "name": level2["name"],
                    "level3": self._generate_level3(level2)
                }

                level1_item["level2"].append(level2_item)
                time.sleep(0.1)  # ç¤¼è²Œæ€§å»¶è¿Ÿ

            industries["level1"].append(level1_item)

        # æ„å»ºä¸‰çº§è¡Œä¸šç´¢å¼•
        industries["level3_index"] = self._build_level3_index(industries)

        print(f"âœ… è¡Œä¸šåˆ†ç±»æŠ“å–å®Œæˆ")
        return industries

    def _generate_level3(self, level2: Dict) -> List[Dict]:
        """
        æ ¹æ®äºŒçº§è¡Œä¸šç”Ÿæˆä¸‰çº§è¡Œä¸šå’Œå…³é”®è¯
        å®é™…åº”ç”¨ä¸­ï¼Œè¿™éƒ¨åˆ†åº”è¯¥ä»é¡µé¢è§£ææˆ–APIè·å–
        """
        level3_map = {
            "è®¡ç®—æœºã€é€šä¿¡å’Œå…¶ä»–ç”µå­è®¾å¤‡åˆ¶é€ ä¸š": [
                {"name": "åŠå¯¼ä½“", "keywords": ["åŠå¯¼ä½“", "èŠ¯ç‰‡", "é›†æˆç”µè·¯", "æ™¶åœ†", "å°æµ‹"]},
                {"name": "ç”µå­å…ƒä»¶", "keywords": ["ç”µå­å…ƒä»¶", "PCB", "ç”µè·¯æ¿", "ç”µå®¹å™¨"]},
                {"name": "æ¶ˆè´¹ç”µå­", "keywords": ["æ¶ˆè´¹ç”µå­", "æ™ºèƒ½æ‰‹æœº", "å¯ç©¿æˆ´", "VR", "AR"]},
                {"name": "é€šä¿¡è®¾å¤‡", "keywords": ["é€šä¿¡è®¾å¤‡", "5G", "åŸºç«™", "å…‰æ¨¡å—"]}
            ],
            "ç”µæ°”æœºæ¢°å’Œå™¨æåˆ¶é€ ä¸š": [
                {"name": "é”‚ç¦»å­ç”µæ± åˆ¶é€ ", "keywords": ["é”‚ç”µæ± ", "é”‚ç”µ", "åŠ¨åŠ›ç”µæ± ", "å‚¨èƒ½ç”µæ± "]},
                {"name": "å…‰ä¼è®¾å¤‡", "keywords": ["å…‰ä¼", "å¤ªé˜³èƒ½", "é€†å˜å™¨", "ç»„ä»¶", "ç¡…ç‰‡"]},
                {"name": "è¾“é…ç”µè®¾å¤‡", "keywords": ["å˜å‹å™¨", "å¼€å…³", "ç”µç½‘", "ç‰¹é«˜å‹"]}
            ],
            "æ±½è½¦åˆ¶é€ ä¸š": [
                {"name": "æ±½è½¦æ•´è½¦", "keywords": ["æ±½è½¦", "æ•´è½¦", "ä¹˜ç”¨è½¦", "å•†ç”¨è½¦"]},
                {"name": "æ±½è½¦é›¶éƒ¨ä»¶", "keywords": ["é›¶éƒ¨ä»¶", "é…ä»¶", "è½®èƒ", "è½¦ç¯"]}
            ],
            "åŒ»è¯åˆ¶é€ ä¸š": [
                {"name": "åŒ–å­¦åˆ¶è¯", "keywords": ["åŒ–å­¦è¯", "åŸæ–™è¯", "ä»¿åˆ¶è¯"]},
                {"name": "ç”Ÿç‰©åˆ¶å“", "keywords": ["ç”Ÿç‰©è¯", "ç–«è‹—", "æŠ—ä½“"]},
                {"name": "ä¸­è¯", "keywords": ["ä¸­è¯", "ä¸­æˆè¯", "ä¸­è¯æ"]}
            ],
            "è´§å¸é‡‘èæœåŠ¡": [
                {"name": "é“¶è¡Œ", "keywords": ["é“¶è¡Œ", "å•†ä¸šé“¶è¡Œ", "å¤®è¡Œ", "é™å‡†", "é™æ¯"]},
                {"name": "è¯åˆ¸", "keywords": ["åˆ¸å•†", "è¯åˆ¸", "æŠ•è¡Œ", "ç»çºªä¸šåŠ¡"]}
            ],
            "èµ„æœ¬å¸‚åœºæœåŠ¡": [
                {"name": "åŸºé‡‘ç®¡ç†", "keywords": ["åŸºé‡‘", "ETF", "å…¬å‹Ÿ", "ç§å‹Ÿ"]},
                {"name": "æŠ•èµ„é“¶è¡Œ", "keywords": ["æŠ•è¡Œ", "IPO", "å¹¶è´­"]}
            ]
        }

        level3_list = []
        base_id = level2["id"]

        for i, item in enumerate(level3_map.get(level2["name"], [])):
            level3_list.append({
                "id": f"{base_id}{i + 1:02d}",
                "name": item["name"],
                "keywords": item["keywords"]
            })

        return level3_list

    def _build_level3_index(self, industries: Dict) -> Dict:
        """æ„å»ºä¸‰çº§è¡Œä¸šå…³é”®è¯ç´¢å¼•"""
        index = {}
        for level1 in industries["level1"]:
            for level2 in level1["level2"]:
                for level3 in level2["level3"]:
                    for keyword in level3["keywords"]:
                        index[keyword] = level3["id"]
        return index

    def fetch_concepts(self) -> List[Dict]:
        """
        æŠ“å–é¢˜ææ¦‚å¿µï¼ˆå®Œæ•´ç‰ˆï¼‰
        ä¸œæ–¹è´¢å¯Œæ¦‚å¿µæ¿å—ï¼šhttps://quote.eastmoney.com/center/conceptlist.html
        """
        print("\nğŸ”„ æ­£åœ¨æŠ“å–é¢˜ææ¦‚å¿µï¼ˆå®Œæ•´ç‰ˆï¼‰...")

        concepts = [
            # ç§‘æŠ€ç±»
            {"id": "C001", "name": "äººå·¥æ™ºèƒ½",
             "keywords": ["AI", "äººå·¥æ™ºèƒ½", "æœºå™¨å­¦ä¹ ", "æ·±åº¦å­¦ä¹ ", "å¤§æ¨¡å‹", "GPT", "ChatGPT"]},
            {"id": "C002", "name": "èŠ¯ç‰‡",
             "keywords": ["èŠ¯ç‰‡", "åŠå¯¼ä½“", "é›†æˆç”µè·¯", "æ™¶åœ†", "å°æµ‹", "å­˜å‚¨èŠ¯ç‰‡", "MCU"]},
            {"id": "C003", "name": "å›½äº§èŠ¯ç‰‡", "keywords": ["å›½äº§èŠ¯ç‰‡", "è‡ªä¸»èŠ¯ç‰‡", "é¾™èŠ¯", "é²²é¹", "æ˜‡è…¾"]},
            {"id": "C004", "name": "5G", "keywords": ["5G", "6G", "é€šä¿¡", "åŸºç«™", "å…‰é€šä¿¡"]},
            {"id": "C005", "name": "äº‘è®¡ç®—", "keywords": ["äº‘è®¡ç®—", "äº‘æœåŠ¡", "SaaS", "IaaS", "PaaS"]},
            {"id": "C006", "name": "å¤§æ•°æ®", "keywords": ["å¤§æ•°æ®", "æ•°æ®è¦ç´ ", "æ•°æ®å®‰å…¨", "æ•°æ®ä¸­å¿ƒ"]},
            {"id": "C007", "name": "ç‰©è”ç½‘", "keywords": ["ç‰©è”ç½‘", "IOT", "æ™ºèƒ½å®¶å±…", "è½¦è”ç½‘"]},
            {"id": "C008", "name": "åŒºå—é“¾", "keywords": ["åŒºå—é“¾", "æ•°å­—è´§å¸", "Web3", "æ¯”ç‰¹å¸", "ä»¥å¤ªåŠ"]},
            {"id": "C009", "name": "å…ƒå®‡å®™", "keywords": ["å…ƒå®‡å®™", "Metaverse", "VR", "AR", "æ•°å­—å­ªç”Ÿ"]},
            {"id": "C010", "name": "ä¿¡åˆ›", "keywords": ["ä¿¡åˆ›", "å›½äº§è½¯ä»¶", "è‡ªä¸»å¯æ§", "æ“ä½œç³»ç»Ÿ", "æ•°æ®åº“"]},
            {"id": "C011", "name": "ç®—åŠ›", "keywords": ["ç®—åŠ›", "æœåŠ¡å™¨", "ç®—åŠ›ç§Ÿèµ", "GPU", "CPU"]},
            {"id": "C012", "name": "æœºå™¨äºº", "keywords": ["æœºå™¨äºº", "å·¥ä¸šæœºå™¨äºº", "äººå½¢æœºå™¨äºº", "æœºå™¨è§†è§‰"]},
            {"id": "C013", "name": "æ¶ˆè´¹ç”µå­", "keywords": ["æ¶ˆè´¹ç”µå­", "æ™ºèƒ½æ‰‹æœº", "å¯ç©¿æˆ´", "VRè®¾å¤‡"]},

            # æ–°èƒ½æºç±»
            {"id": "C101", "name": "æ–°èƒ½æºè½¦",
             "keywords": ["æ–°èƒ½æºè½¦", "ç”µåŠ¨æ±½è½¦", "æ–°èƒ½æºæ±½è½¦", "ç”µåŠ¨è½¦", "ç”µé©±", "å……ç”µæ¡©"]},
            {"id": "C102", "name": "é”‚ç”µæ± ", "keywords": ["é”‚ç”µæ± ", "é”‚ç”µ", "åŠ¨åŠ›ç”µæ± ", "å‚¨èƒ½ç”µæ± ", "å›ºæ€ç”µæ± "]},
            {"id": "C103", "name": "å…‰ä¼", "keywords": ["å…‰ä¼", "å¤ªé˜³èƒ½", "é€†å˜å™¨", "ç»„ä»¶", "ç¡…ç‰‡", "HJT", "TOPCon"]},
            {"id": "C104", "name": "é£ç”µ", "keywords": ["é£ç”µ", "é£åŠ›å‘ç”µ", "æµ·ä¸Šé£ç”µ", "é£æœº"]},
            {"id": "C105", "name": "å‚¨èƒ½", "keywords": ["å‚¨èƒ½", "æŠ½æ°´è“„èƒ½", "ç”µåŒ–å­¦å‚¨èƒ½", "é’ ç”µæ± "]},
            {"id": "C106", "name": "æ°¢èƒ½", "keywords": ["æ°¢èƒ½", "æ°¢èƒ½æº", "ç‡ƒæ–™ç”µæ± ", "ç”µè§£æ§½"]},
            {"id": "C107", "name": "å……ç”µæ¡©", "keywords": ["å……ç”µæ¡©", "å……ç”µç«™", "æ¢ç”µ", "è¶…å……"]},
            {"id": "C108", "name": "ç‰¹é«˜å‹", "keywords": ["ç‰¹é«˜å‹", "æ™ºèƒ½ç”µç½‘", "ç”µç½‘", "è¾“é…ç”µ"]},
            {"id": "C109", "name": "æ ¸èƒ½", "keywords": ["æ ¸èƒ½", "æ ¸ç”µ", "æ ¸ç”µç«™", "é“€"]},

            # å†›å·¥èˆªå¤©
            {"id": "C201", "name": "å†›å·¥", "keywords": ["å†›å·¥", "å›½é˜²", "èˆªå¤©", "èˆªç©º", "å†›å·¥ç”µå­"]},
            {"id": "C202", "name": "èˆªå¤©", "keywords": ["èˆªå¤©", "å«æ˜Ÿ", "ç«ç®­", "åŒ—æ–—", "ç©ºé—´ç«™"]},
            {"id": "C203", "name": "å¤§é£æœº", "keywords": ["å¤§é£æœº", "C919", "ARJ21", "èˆªç©ºåˆ¶é€ "]},
            {"id": "C204", "name": "æ— äººæœº", "keywords": ["æ— äººæœº", "ä½ç©ºç»æµ", "eVTOL", "é£è¡Œæ±½è½¦"]},
            {"id": "C205", "name": "ä½ç©ºç»æµ", "keywords": ["ä½ç©ºç»æµ", "æ— äººæœº", "é£è¡Œæ±½è½¦", "eVTOL", "ç©ºç®¡"]},

            # åŒ»è¯å¥åº·
            {"id": "C301", "name": "åˆ›æ–°è¯", "keywords": ["åˆ›æ–°è¯", "æ–°è¯", "æŠ—ç™Œè¯", "é¶å‘è¯", "ç”Ÿç‰©è¯"]},
            {"id": "C302", "name": "ä¸­è¯", "keywords": ["ä¸­è¯", "ä¸­æˆè¯", "ä¸­è¯æ", "é…æ–¹é¢—ç²’"]},
            {"id": "C303", "name": "åŒ»ç–—å™¨æ¢°", "keywords": ["åŒ»ç–—å™¨æ¢°", "åŒ»ç–—è®¾å¤‡", "è€—æ", "ä½“å¤–è¯Šæ–­"]},
            {"id": "C304", "name": "åŒ»ç–—æœåŠ¡", "keywords": ["åŒ»ç–—æœåŠ¡", "åŒ»é™¢", "CXO", "CRO", "CDMO"]},
            {"id": "C305", "name": "ç–«è‹—", "keywords": ["ç–«è‹—", "mRNA", "æ–°å† ç–«è‹—", "HPVç–«è‹—"]},
            {"id": "C306", "name": "åŸºå› æµ‹åº", "keywords": ["åŸºå› ", "æµ‹åº", "CRISPR", "åŸºå› ç¼–è¾‘"]},

            # é‡‘èåœ°äº§
            {"id": "C401", "name": "åˆ¸å•†", "keywords": ["åˆ¸å•†", "è¯åˆ¸", "æŠ•è¡Œ", "ç»çºªä¸šåŠ¡", "èµ„ç®¡"]},
            {"id": "C402", "name": "é“¶è¡Œ", "keywords": ["é“¶è¡Œ", "å•†ä¸šé“¶è¡Œ", "å¤®è¡Œ", "é™å‡†", "é™æ¯"]},
            {"id": "C403", "name": "ä¿é™©", "keywords": ["ä¿é™©", "å¯¿é™©", "è´¢é™©", "å†ä¿é™©"]},
            {"id": "C404", "name": "ä¿¡æ‰˜", "keywords": ["ä¿¡æ‰˜", "èµ„ç®¡", "ç†è´¢"]},
            {"id": "C405", "name": "æˆ¿åœ°äº§", "keywords": ["æˆ¿åœ°äº§", "åœ°äº§", "æˆ¿ä¼", "ç‰©ä¸š", "å•†ä¸šåœ°äº§"]},
            {"id": "C406", "name": "REITs", "keywords": ["REITs", "åŸºç¡€è®¾æ–½REITs", "ä¸åŠ¨äº§"]},

            # å‘¨æœŸèµ„æº
            {"id": "C501", "name": "æœ‰è‰²é‡‘å±", "keywords": ["æœ‰è‰²é‡‘å±", "é“œ", "é“", "é”Œ", "é“…", "é•", "é’´"]},
            {"id": "C502", "name": "é»„é‡‘", "keywords": ["é»„é‡‘", "é‡‘çŸ¿", "è´µé‡‘å±"]},
            {"id": "C503", "name": "ç¨€åœŸ", "keywords": ["ç¨€åœŸ", "æ°¸ç£", "ç£æ"]},
            {"id": "C504", "name": "é’¢é“", "keywords": ["é’¢é“", "ç‰¹é’¢", "ä¸é”ˆé’¢", "èºçº¹é’¢"]},
            {"id": "C505", "name": "ç…¤ç‚­", "keywords": ["ç…¤ç‚­", "ç„¦ç…¤", "åŠ¨åŠ›ç…¤"]},
            {"id": "C506", "name": "çŸ³æ²¹", "keywords": ["çŸ³æ²¹", "åŸæ²¹", "æ²¹æ°”", "é¡µå²©æ²¹"]},
            {"id": "C507", "name": "å¤©ç„¶æ°”", "keywords": ["å¤©ç„¶æ°”", "LNG", "ç‡ƒæ°”"]},
            {"id": "C508", "name": "åŒ–å·¥", "keywords": ["åŒ–å·¥", "åŒ–è‚¥", "å†œè¯", "åŒ–çº¤", "MDI", "TDI"]},

            # æ¶ˆè´¹ç±»
            {"id": "C601", "name": "ç™½é…’", "keywords": ["ç™½é…’", "èŒ…å°", "äº”ç²®æ¶²", "é…’"]},
            {"id": "C602", "name": "é£Ÿå“é¥®æ–™", "keywords": ["é£Ÿå“", "é¥®æ–™", "ä¹³ä¸š", "è°ƒå‘³å“", "é¢„åˆ¶èœ"]},
            {"id": "C603", "name": "å…ç¨", "keywords": ["å…ç¨", "å…ç¨åº—", "ä¸­å›½ä¸­å…"]},
            {"id": "C604", "name": "æ—…æ¸¸", "keywords": ["æ—…æ¸¸", "é…’åº—", "æ™¯åŒº", "æ—…è¡Œç¤¾"]},
            {"id": "C605", "name": "é›¶å”®", "keywords": ["é›¶å”®", "è¶…å¸‚", "ç™¾è´§", "ç”µå•†"]},
            {"id": "C606", "name": "å®¶ç”µ", "keywords": ["å®¶ç”µ", "ç©ºè°ƒ", "å†°ç®±", "æ´—è¡£æœº", "å¨ç”µ"]},
            {"id": "C607", "name": "å®¶å±…", "keywords": ["å®¶å±…", "å®¶å…·", "å®¶è£…", "åºŠå«"]},
            {"id": "C608", "name": "çººç»‡æœè£…", "keywords": ["çººç»‡", "æœè£…", "é‹å¸½", "ç¾½ç»’æœ"]},

            # æ”¿ç­–ç±»
            {"id": "C701", "name": "å›½ä¼æ”¹é©", "keywords": ["å›½ä¼æ”¹é©", "å¤®ä¼", "å›½èµ„", "æ··æ”¹"]},
            {"id": "C702", "name": "ä¸€å¸¦ä¸€è·¯", "keywords": ["ä¸€å¸¦ä¸€è·¯", "ä¸ç»¸ä¹‹è·¯", "ä¸­æ¬§ç­åˆ—"]},
            {"id": "C703", "name": "ä¹¡æ‘æŒ¯å…´", "keywords": ["ä¹¡æ‘æŒ¯å…´", "ä¸‰å†œ", "å†œä¸šç°ä»£åŒ–"]},
            {"id": "C704", "name": "ç¢³ä¸­å’Œ", "keywords": ["ç¢³ä¸­å’Œ", "ç¢³è¾¾å³°", "ç¢³æ’æ”¾", "CCER", "ç¢³äº¤æ˜“"]},
            {"id": "C705", "name": "ç»¿è‰²ç”µåŠ›", "keywords": ["ç»¿ç”µ", "ç»¿è‰²ç”µåŠ›", "æ¸…æ´èƒ½æº"]},
            {"id": "C706", "name": "ç¯ä¿", "keywords": ["ç¯ä¿", "æ±¡æ°´å¤„ç†", "å›ºåºŸå¤„ç†", "å¤§æ°”æ²»ç†"]},
            {"id": "C707", "name": "ä¸“ç²¾ç‰¹æ–°", "keywords": ["ä¸“ç²¾ç‰¹æ–°", "å°å·¨äºº", "éšå½¢å† å†›"]},
            {"id": "C708", "name": "å›½äº§æ›¿ä»£", "keywords": ["å›½äº§æ›¿ä»£", "è‡ªä¸»å¯æ§", "è¿›å£æ›¿ä»£"]},

            # å…¶ä»–çƒ­é—¨
            {"id": "C801", "name": "è·¨å¢ƒç”µå•†", "keywords": ["è·¨å¢ƒç”µå•†", "å‡ºæµ·", "å¤–è´¸"]},
            {"id": "C802", "name": "æŠ–éŸ³æ¦‚å¿µ", "keywords": ["æŠ–éŸ³", "å­—èŠ‚è·³åŠ¨", "TikTok"]},
            {"id": "C803", "name": "å¿«æ‰‹æ¦‚å¿µ", "keywords": ["å¿«æ‰‹", "çŸ­è§†é¢‘"]},
            {"id": "C804", "name": "æ‹¼å¤šå¤šæ¦‚å¿µ", "keywords": ["æ‹¼å¤šå¤š", "ç”µå•†"]},
            {"id": "C805", "name": "ç‰¹æ–¯æ‹‰", "keywords": ["ç‰¹æ–¯æ‹‰", "Tesla"]},
            {"id": "C806", "name": "åä¸ºæ¦‚å¿µ", "keywords": ["åä¸º", "é¸¿è’™", "éº’éºŸ", "æ˜‡è…¾"]},
            {"id": "C807", "name": "è‹¹æœæ¦‚å¿µ", "keywords": ["è‹¹æœ", "iPhone", "ä¾›åº”é“¾"]},
            {"id": "C808", "name": "å°ç±³æ¦‚å¿µ", "keywords": ["å°ç±³", "ç”Ÿæ€é“¾"]},
            {"id": "C809", "name": "æ¯”äºšè¿ªæ¦‚å¿µ", "keywords": ["æ¯”äºšè¿ª", "BYD"]},
            {"id": "C810", "name": "å®å¾·æ—¶ä»£æ¦‚å¿µ", "keywords": ["å®å¾·æ—¶ä»£", "CATL"]},
            {"id": "C811", "name": "ç‹¬è§’å…½", "keywords": ["ç‹¬è§’å…½", "æ‹Ÿä¸Šå¸‚"]},
            {"id": "C812", "name": "æ¬¡æ–°è‚¡", "keywords": ["æ¬¡æ–°è‚¡", "æ–°è‚¡"]},
            {"id": "C813", "name": "é«˜é€è½¬", "keywords": ["é«˜é€è½¬", "é€è‚¡", "è½¬è‚¡"]},
            {"id": "C814", "name": "STæ¿å—", "keywords": ["ST", "*ST", "é€€å¸‚"]},
        ]

        print(f"âœ… é¢˜ææ¦‚å¿µæŠ“å–å®Œæˆï¼Œå…± {len(concepts)} ä¸ª")
        return concepts

    def update_tags_file(self):
        """æ›´æ–° tags.json æ–‡ä»¶"""
        print("=" * 60)
        print("ğŸš€ å¼€å§‹æ›´æ–°æ ‡ç­¾åº“")
        print("=" * 60)

        # æŠ“å–æ•°æ®
        industries = self.fetch_industries()
        concepts = self.fetch_concepts()

        # æ„å»ºå®Œæ•´çš„æ ‡ç­¾åº“
        tags = {
            "version": datetime.now().strftime("%Y-%m-%d"),
            "last_update": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
            "industries": industries,
            "concepts": concepts
        }

        # ä¿å­˜åˆ°æ–‡ä»¶
        project_root = Path(__file__).parent.parent.parent
        tags_path = project_root / "data" / "tags.json"

        # ç¡®ä¿ç›®å½•å­˜åœ¨
        tags_path.parent.mkdir(exist_ok=True)

        with open(tags_path, "w", encoding="utf-8") as f:
            json.dump(tags, f, ensure_ascii=False, indent=2)

        # ç»Ÿè®¡ä¿¡æ¯
        industry_count = len(industries.get("level3_index", {}))
        concept_count = len(concepts)

        print("\n" + "=" * 60)
        print(f"âœ… æ ‡ç­¾åº“æ›´æ–°å®Œæˆï¼")
        print(f"ğŸ“ ä¿å­˜è·¯å¾„: {tags_path}")
        print(f"ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:")
        print(f"  - ä¸‰çº§è¡Œä¸šæ•°: {industry_count}")
        print(f"  - é¢˜ææ¦‚å¿µæ•°: {concept_count}")
        print(f"  - ç‰ˆæœ¬: {tags['version']}")
        print(f"  - æ›´æ–°æ—¶é—´: {tags['last_update']}")
        print("=" * 60)


def main():
    fetcher = EastMoneyTagFetcher()
    fetcher.update_tags_file()


if __name__ == "__main__":
    main()